<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.0">
    <meta name="project" content="Trento Web v2.2.0">

    <title>Trento.Clusters.Cluster â€” Trento Web v2.2.0</title>
    <link rel="stylesheet" href="dist/html-elixir-2YOS5DIE.css" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-X7YVL3G2.js"></script>
    <script src="dist/sidebar_items-48A322AB.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-XN2TSG4M.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="readme.html">
        <img src="assets/logo.svg" alt="Trento Web" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="readme.html" class="sidebar-projectName" translate="no">
Trento Web
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v2.2.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">GUIDES</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


        <li><a id="tasks-list-link" href="#full-list"><span translate="no">Mix</span> Tasks</a></li>

    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">Trento.Clusters.Cluster</span> 
  <small class="app-vsn" translate="no">(Trento Web v2.2.0)</small>

</h1>


  <section id="moduledoc">
<p>The cluster aggregate manages all the domain logic related to
deployed HA Clusters (Pacemaker, Corosync, etc).
The HA cluster is used to handle the high availability scenarios on the installed
SAP infrastructure. That's why this domain is tailored to work on clusters managing
SAP workloads.</p><p>Each deployed cluster is registered as a new aggregate entry, meaning that all the hosts belonging
to the same cluster are part of the same stream.</p><p>A new cluster is registered when a cluster discovery message from any of the nodes of the cluster is received.</p><p>The cluster details will be populated if the received discovery message is coming from the <strong>designated controller</strong> node.
Otherwise the cluster details are left as unknown, and filled once a message from the <strong>designated controller</strong> is received.
Once a cluster is registered, other hosts will be added when cluster discovery messages from them are received.</p><p>All the hosts are listed in the <code class="inline">hosts</code> field.</p><p>The cluster aggregate stores and updates information coming in the cluster discovery messages such as:</p><ul><li>Cluster name</li><li>Number of hosts and cluster resources</li><li>Platform where the host is running (the cloud provider for instance)</li><li>Managed SAP workload SID</li></ul><h2 id="module-cluster-health" class="section-heading">
  <a href="#module-cluster-health" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">cluster-health</p>
  </a>
  Cluster health
</h2>
<p>The cluster health is one of the most relevant concepts of this domain.
It shows if the cluster is working as expected or not, and in the second case,
what is the roout cause of the issue and if there is some possible remediation.
It is composed by sub-health elements:</p><ul><li>Discovered health</li><li>Checks health</li></ul><p>The main cluster health is computed using the values from these two. This means that the cluster health is the
worst of the two.</p><h3 id="module-discovered-health" class="section-heading">
  <a href="#module-discovered-health" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">discovered-health</p>
  </a>
  Discovered health
</h3>
<p>The discovered health comes from the cluster discovery messages and it depends on the cluster type.
Each cluster type has a different way of evaluating the health.</p><h3 id="module-checks-health" class="section-heading">
  <a href="#module-checks-health" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">checks-health</p>
  </a>
  Checks health
</h3>
<p>The checks health is obtained from the <a href="https://github.com/trento-project/wanda/">Checks Engine executions</a>.
Every time a checks execution is started, the selected checks for this cluster are executed, and based on the result
the health value is updated. The checks are started from a user request or periodically following the
project scheduler configuration.</p><p>This domain only knows about the health, the details about the execution are stored in the
<a href="https://github.com/trento-project/wanda/">Checks Engine</a>.</p>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>

  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#t:t/0" translate="no">t()</a>

        </div>

      </div>

  </div>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#apply/2" translate="no">apply(cluster, arg2)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#cast_and_validate_required_embed/3" translate="no">cast_and_validate_required_embed(changeset, field, required_fields)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#cast_and_validate_required_polymorphic_embed/3" translate="no">cast_and_validate_required_polymorphic_embed(changeset, field, required_fields)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#changeset/2" translate="no">changeset(struct, params)</a>

        </div>

          <div class="summary-synopsis"><p>Casts the fields by using Ecto reflection,
validates the required ones and returns a changeset.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#execute/2" translate="no">execute(cluster, command)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#new/1" translate="no">new(structs)</a>

        </div>

          <div class="summary-synopsis"><p>Returns an ok tuple if the params are valid, otherwise returns <code class="inline">{:error, {:validation, errors}}</code>.
Accepts a map or a list of maps.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#new!/1" translate="no">new!(params)</a>

        </div>

          <div class="summary-synopsis"><p>Returns new struct(s) if the params are valid, otherwise raises a <a href="https://hexdocs.pm/elixir/RuntimeError.html"><code class="inline">RuntimeError</code></a>.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#validate_required_fields/2" translate="no">validate_required_fields(changeset, required_fields)</a>

        </div>

      </div>

  </div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Types
    </h1>
    <div class="types-list">
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">t()</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: %Trento.Clusters.Cluster{
  additional_sids: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  checks_health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  cluster_id: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  deregistered_at: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  details: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  discovered_health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  hosts: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  hosts_number: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  name: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  provider: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  resources_number: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  rolling_up: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  selected_checks: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  sid: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  type: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()
}</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="apply/2">

  <div class="detail-header">
    <a href="#apply/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">apply(cluster, arg2)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L340" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="cast_and_validate_required_embed/3">

  <div class="detail-header">
    <a href="#cast_and_validate_required_embed/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cast_and_validate_required_embed(changeset, field, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="cast_and_validate_required_polymorphic_embed/3">

  <div class="detail-header">
    <a href="#cast_and_validate_required_polymorphic_embed/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cast_and_validate_required_polymorphic_embed(changeset, field, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="changeset/2">

  <div class="detail-header">
    <a href="#changeset/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changeset(struct, params)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Casts the fields by using Ecto reflection,
validates the required ones and returns a changeset.</p>
  </section>
</section>
<section class="detail" id="execute/2">

  <div class="detail-header">
    <a href="#execute/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">execute(cluster, command)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L141" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="new/1">

  <div class="detail-header">
    <a href="#new/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">new(structs)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> new(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()]) :: {:ok, <a href="#t:t/0">t</a>() | [<a href="#t:t/0">t</a>()]} | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}</pre>

      </div>

<p>Returns an ok tuple if the params are valid, otherwise returns <code class="inline">{:error, {:validation, errors}}</code>.
Accepts a map or a list of maps.</p>
  </section>
</section>
<section class="detail" id="new!/1">

  <div class="detail-header">
    <a href="#new!/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">new!(params)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> new!(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()]) :: <a href="#t:t/0">t</a>() | [<a href="#t:t/0">t</a>()]</pre>

      </div>

<p>Returns new struct(s) if the params are valid, otherwise raises a <a href="https://hexdocs.pm/elixir/RuntimeError.html"><code class="inline">RuntimeError</code></a>.</p>
  </section>
</section>
<section class="detail" id="validate_required_fields/2">

  <div class="detail-header">
    <a href="#validate_required_fields/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">validate_required_fields(changeset, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/clusters/cluster.ex#L111" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>

    </div>
  </section>

      <footer class="footer">

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.0) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
