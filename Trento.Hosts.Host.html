<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.1">
    <meta name="project" content="Trento Web v2.3.1">


    <title>Trento.Hosts.Host â€” Trento Web v2.3.1</title>
    <link rel="stylesheet" href="dist/html-elixir-FM2CSD74.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-F680A558.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-L4O5OK2K.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<div class="background-layer"></div>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="readme.html" class="sidebar-projectImage">
          <img src="assets/logo.svg" alt="Trento Web" />
        </a>

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
Trento Web
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.3.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Trento Web</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <div class="autocomplete">
          </div>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>

      </div>

<h1>

    <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">Trento.Hosts.Host</span> 
  <small class="app-vsn" translate="no">(Trento Web v2.3.1)</small>

</h1>


  <section id="moduledoc">
<p>The host aggregate manages all the domain logic related to individual hosts
(agent, in other term) that compose the target infrastructure running SAP systems.</p><p>Each host running a Trento agent is registered as a new aggregate entry.
New host discovery messages update the aggregate values if there is some difference.
The host aggregate stores information such as:</p><ul><li>Host basic information as the hostname and ip addresses</li><li>Hardware specifications</li><li>Platform where the host is running (the cloud provider for instance)</li><li>Registered SLES4SAP subscriptions</li></ul><p>Besides these mostly static values, the aggregate takes care of handling
heartbeats, checks execution result, saptune status</p><h2 id="module-host-health" class="section-heading">
  <a href="#module-host-health" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Host health</span>
</h2>
<p>Holds the information about whether the host is in an expected state or not, and if not,
what is the roout cause helping identifying possible remediation.
It is composed by sub-health elements:</p><ul><li>Heartbeat status</li><li>Checks health</li></ul><p>The main host health is computed using these values, meaning the host health is the worst of the two.</p><h3 id="module-heartbeat" class="section-heading">
  <a href="#module-heartbeat" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Heartbeat</span>
</h3>
<p>Each host in the targe SAP infrastructure running a Trento agent sends a heartbeat message and
if a heartbeat is not received within a 10 seconds period (configurable),
a heartbeat failure event is raised changing the health of the host as critical.</p><h3 id="module-checks-health" class="section-heading">
  <a href="#module-checks-health" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Checks health</span>
</h3>
<p>The checks health is obtained from the <a href="https://github.com/trento-project/wanda/">Checks Engine executions</a>.
Every time a checks execution for a host completes the execution's result is taken into account to determine host's health.
Checks execution is started either by an explicit user request or periodically as per the scheduler configuration.</p><h3 id="module-software-updates-discovery" class="section-heading">
  <a href="#module-software-updates-discovery" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Software Updates Discovery</span>
</h3>
<p>Business process integrating with an external service, SUMA, determining relevant patches and upgradable packages for a host.
Process is triggered</p><ul><li>on host registration</li><li>when the fqdn of the host changes</li><li>on host restoration</li><li>every given amount of time</li><li>on demand (ie the integration settings with the external service change)</li></ul><p>Presence of relevant patches determines Software Updates Discovery health and concurs to the host's aggregated health as follows:</p><ul><li>critical if there is at least one security advisory</li><li>warning if there are only buxfixes/software enhancements</li></ul><p>The Software Updates Discovery health is computed in the integration layer
and only the resulting health is dispatched to the host aggregate along with CompleteSoftwareUpdatesDiscovery command.</p>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:t/0" translate="no">t()</a>

      </div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#apply/2" translate="no">apply(host, arg2)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cast_and_validate_required_embed/3" translate="no">cast_and_validate_required_embed(changeset, field, required_fields)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cast_and_validate_required_polymorphic_embed/3" translate="no">cast_and_validate_required_polymorphic_embed(changeset, field, required_fields)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changeset/2" translate="no">changeset(struct, params)</a>

      </div>

        <div class="summary-synopsis"><p>Casts the fields by using Ecto reflection,
validates the required ones and returns a changeset.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#execute/2" translate="no">execute(snapshot, arg2)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#maybe_emit_software_updates_discovery_events/3" translate="no">maybe_emit_software_updates_discovery_events(host_id, fqdn, fqdn)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#new/1" translate="no">new(structs)</a>

      </div>

        <div class="summary-synopsis"><p>Returns an ok tuple if the params are valid, otherwise returns <code class="inline">{:error, {:validation, errors}}</code>.
Accepts a map or a list of maps.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#new!/1" translate="no">new!(params)</a>

      </div>

        <div class="summary-synopsis"><p>Returns new struct(s) if the params are valid, otherwise raises a <a href="https://hexdocs.pm/elixir/RuntimeError.html"><code class="inline">RuntimeError</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#validate_required_fields/2" translate="no">validate_required_fields(changeset, required_fields)</a>

      </div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">t()</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: %Trento.Hosts.Host{
  agent_version: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  checks_health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  cpu_count: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  deregistered_at: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  fully_qualified_domain_name: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  heartbeat: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  host_id: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  hostname: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  installation_source: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  ip_addresses: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  os_version: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  provider: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  provider_data: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  rolling_up: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  saptune_health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  saptune_status: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  selected_checks: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  socket_count: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  software_updates_discovery_health: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  subscriptions: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  total_memory_mb: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()
}</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="apply/2">

  <div class="detail-header">
    <a href="#apply/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">apply(host, arg2)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L596" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="cast_and_validate_required_embed/3">

  <div class="detail-header">
    <a href="#cast_and_validate_required_embed/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cast_and_validate_required_embed(changeset, field, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="cast_and_validate_required_polymorphic_embed/3">

  <div class="detail-header">
    <a href="#cast_and_validate_required_polymorphic_embed/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cast_and_validate_required_polymorphic_embed(changeset, field, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="changeset/2">

  <div class="detail-header">
    <a href="#changeset/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changeset(struct, params)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Casts the fields by using Ecto reflection,
validates the required ones and returns a changeset.</p>
  </section>
</section>
<section class="detail" id="execute/2">

  <div class="detail-header">
    <a href="#execute/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">execute(snapshot, arg2)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L159" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="maybe_emit_software_updates_discovery_events/3">

  <div class="detail-header">
    <a href="#maybe_emit_software_updates_discovery_events/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">maybe_emit_software_updates_discovery_events(host_id, fqdn, fqdn)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L836" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="new/1">

  <div class="detail-header">
    <a href="#new/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">new(structs)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> new(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()]) :: {:ok, <a href="#t:t/0">t</a>() | [<a href="#t:t/0">t</a>()]} | {:error, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()}</pre>

      </div>

<p>Returns an ok tuple if the params are valid, otherwise returns <code class="inline">{:error, {:validation, errors}}</code>.
Accepts a map or a list of maps.</p>
  </section>
</section>
<section class="detail" id="new!/1">

  <div class="detail-header">
    <a href="#new!/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">new!(params)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> new!(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()]) :: <a href="#t:t/0">t</a>() | [<a href="#t:t/0">t</a>()]</pre>

      </div>

<p>Returns new struct(s) if the params are valid, otherwise raises a <a href="https://hexdocs.pm/elixir/RuntimeError.html"><code class="inline">RuntimeError</code></a>.</p>
  </section>
</section>
<section class="detail" id="validate_required_fields/2">

  <div class="detail-header">
    <a href="#validate_required_fields/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">validate_required_fields(changeset, required_fields)</h1>

      <a href="https://github.com/trento-project/web/blob/main/lib/trento/hosts/host.ex#L117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Trento Web.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>


  </body>
</html>
